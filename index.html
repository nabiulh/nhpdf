<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NabiulWord - Smart Notepad</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Bengali:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --bg: #0f172a;
            --surface: #1e293b;
            --text: #f1f5f9;
            --accent: #22d3ee;
            --page-bg: #ffffff;
            --page-text: #1a1a1a;
        }
        
        .theme-ocean { --primary: #0ea5e9; --secondary: #06b6d4; --bg: #0c1222; --surface: #1a2744; --text: #e0f2fe; --accent: #38bdf8; }
        .theme-forest { --primary: #22c55e; --secondary: #10b981; --bg: #0a1a12; --surface: #14332a; --text: #dcfce7; --accent: #4ade80; }
        .theme-sunset { --primary: #f97316; --secondary: #fb923c; --bg: #1c0f0a; --surface: #3d2317; --text: #ffedd5; --accent: #fdba74; }
        .theme-rose { --primary: #ec4899; --secondary: #f472b6; --bg: #1a0a14; --surface: #3d1a2e; --text: #fce7f3; --accent: #f9a8d4; }
        .theme-light { --primary: #6366f1; --secondary: #8b5cf6; --bg: #f8fafc; --surface: #ffffff; --text: #1e293b; --accent: #3b82f6; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', 'Noto Sans Bengali', sans-serif; }
        
        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: all 0.4s ease;
            filter: brightness(var(--brightness, 1));
            position: relative;
        }
        
        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 1) 100%), repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(99, 102, 241, 0.03) 50px, rgba(99, 102, 241, 0.03) 51px);
            pointer-events: none; z-index: 0;
        }
        
        body::after {
            content: ''; position: fixed; top: 0; left: 0; right: 0; height: 130px;
            background: linear-gradient(180deg, rgba(37, 99, 235, 0.15) 0%, transparent 100%);
            pointer-events: none; z-index: 0;
        }
        
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .main-container { position: relative; z-index: 1; }
        
        /* A4 Page Styling */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: var(--page-bg);
            color: var(--page-text);
            padding: 5mm;
            margin: 20px auto;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.08), 0 8px 32px rgba(0,0,0,0.12), 0 16px 48px rgba(0,0,0,0.15);
            position: relative;
            border: none;
            overflow: visible;
        }
        
        /* Borders */
        .a4-page::before { content: ''; position: absolute; top: 6mm; left: 6mm; right: 6mm; bottom: 6mm; border: 2px solid #000; pointer-events: none; }
        .a4-page::after { content: ''; position: absolute; top: 7.5mm; left: 7.5mm; right: 7.5mm; bottom: 7.5mm; border: 0.8px solid #1a1a1a; pointer-events: none; }
        
        .editor-area {
            font-size: 12px;
            line-height: 1.6;
            min-height: calc(297mm - 35mm);
            outline: none;
            color: #1a1a1a;
            padding: 8mm 4mm 25mm 4mm;
            margin: 8mm 7mm 12mm 7mm;
            overflow-wrap: break-word;
            word-wrap: break-word;
            text-align: justify;
        }
        
        /* --- ULTIMATE FIX FOR LINE CUTTING --- */
        .editor-area p, .editor-area div, .editor-area li, .editor-area h1, .editor-area h2, .editor-area h3, .editor-area table {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
            /* Small padding bottom helps letters like g,j,y,p,q not get cut */
            padding-bottom: 2px; 
            margin-bottom: 5px;
        }
        
        .editor-area span, .editor-area a, .editor-area b, .editor-area i, .editor-area u { display: inline !important; }
        
        @media print {
            .a4-page { page-break-after: always; page-break-inside: avoid; }
            .editor-area { padding-top: 10mm !important; padding-bottom: 20mm !important; }
        }
        
        .editor-area:empty::before { content: 'Paste or type your content here...'; color: #999; font-style: italic; }
        
        .page-number {
            position: absolute; bottom: 8mm; left: 50%; transform: translateX(-50%);
            font-size: 9px; color: #000; background: white; padding: 2px 12px;
            border-radius: 3px; border: 1px solid #333; font-weight: 600; z-index: 10;
        }
        
        .watermark { position: absolute; bottom: 12mm; right: 10mm; width: 1.5in; height: 1.5in; opacity: 0.3; pointer-events: none; z-index: 1; }
        .watermark img { width: 100%; height: 100%; object-fit: contain; }
        
        /* UI Components */
        .color-picker-container { position: relative; }
        .color-dropdown {
            position: absolute; top: 32px; left: 50%; transform: translateX(-50%);
            background: #1f2937; border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px; padding: 8px; display: none;
            grid-template-columns: repeat(5, 1fr); gap: 5px; z-index: 200; box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }
        .color-dropdown.show { display: grid; }
        .color-btn { width: 20px; height: 20px; border-radius: 50%; cursor: pointer; border: 1.5px solid transparent; transition: all 0.2s ease; }
        .color-btn:hover { transform: scale(1.15); border-color: white; }
        
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4); }
        
        .hamburger {
            position: fixed; top: 10px; left: 10px; z-index: 100;
            width: 36px; height: 36px; background: linear-gradient(145deg, #2563eb, #1d4ed8);
            border-radius: 6px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            gap: 4px; cursor: pointer; box-shadow: 0 2px 8px rgba(37, 99, 235, 0.4); border: none;
        }
        .hamburger span { width: 18px; height: 2px; background: white; border-radius: 2px; transition: all 0.3s; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(4px, 4px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(4px, -4px); }
        
        .export-btn { position: fixed; top: 50px; right: 15px; z-index: 100; }
        .export-btn button { padding: 6px 12px !important; font-size: 11px !important; border-radius: 20px !important; background: linear-gradient(135deg, #10b981, #059669) !important; }
        
        .toolbar {
            position: fixed; top: 8px; left: 50%; transform: translateX(-50%); z-index: 90;
            display: flex; flex-wrap: wrap; justify-content: center; gap: 2px; padding: 5px 8px;
            border-radius: 8px; background: linear-gradient(180deg, #374151 0%, #1f2937 100%);
            border: 1px solid rgba(255, 255, 255, 0.1); max-width: 320px;
        }
        .toolbar button { width: 26px; height: 26px; border-radius: 4px; display: flex; align-items: center; justify-content: center; background: transparent; border: none; }
        .toolbar button:hover { background: rgba(255,255,255,0.15); }
        .toolbar-divider { width: 1px; height: 18px; background: rgba(255, 255, 255, 0.15); margin: 4px 3px; }
        
        .theme-card { cursor: pointer; transition: all 0.3s ease; }
        .theme-card:hover { transform: scale(1.05); }
        
        .status-bar {
            position: fixed; bottom: 0; left: 0; right: 0; padding: 8px 20px;
            display: flex; justify-content: space-between; font-size: 11px; z-index: 50;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%); border-top: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        @media print, screen and (max-width: 800px) {
            .a4-page { width: 100%; min-height: auto; padding: 15mm; margin: 10px; }
        }
        
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="theme-default">
    <!-- Menu & Buttons -->
    <div class="hamburger" id="hamburgerBtn"><span></span><span></span><span></span></div>

    <div class="export-btn">
        <button id="exportBtn" class="btn-primary px-5 py-3 rounded-2xl text-white font-medium flex items-center gap-2 shadow-lg">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            Export PDF
        </button>
    </div>

    <!-- Floating Toolbar -->
    <div class="toolbar glass">
        <button onclick="formatText('bold')" title="Bold"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"/></svg></button>
        <button onclick="formatText('italic')" title="Italic"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 4h4m-2 0v16m-4 0h8"/></svg></button>
        <button onclick="formatText('underline')" title="Underline"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v7a5 5 0 0010 0V4M5 21h14"/></svg></button>
        <div class="toolbar-divider"></div>
        <button onclick="changeSelectedFontSize(-1)" class="text-blue-400"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg></button>
        <span class="text-xs px-1 text-white/70">A</span>
        <button onclick="changeSelectedFontSize(1)" class="text-green-400"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg></button>
        <div class="toolbar-divider"></div>
        <div class="color-picker-container">
            <button onmousedown="saveSelection()" onclick="toggleColorPicker()" class="text-yellow-400" id="colorPickerBtn">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="12" cy="12" r="5" fill="currentColor"/></svg>
            </button>
            <div class="color-dropdown" id="colorDropdown">
                <div class="color-btn" style="background:#000000" onclick="applyColor('#000000')"></div>
                <div class="color-btn" style="background:#ffffff; border:1px solid #ccc" onclick="applyColor('#ffffff')"></div>
                <div class="color-btn" style="background:#ef4444" onclick="applyColor('#ef4444')"></div>
                <div class="color-btn" style="background:#22c55e" onclick="applyColor('#22c55e')"></div>
                <div class="color-btn" style="background:#3b82f6" onclick="applyColor('#3b82f6')"></div>
                <div class="color-btn" style="background:#8b5cf6" onclick="applyColor('#8b5cf6')"></div>
                <div class="color-btn" style="background:#f97316" onclick="applyColor('#f97316')"></div>
                <div class="color-btn" style="background:#eab308" onclick="applyColor('#eab308')"></div>
                <div class="color-btn" style="background:#ec4899" onclick="applyColor('#ec4899')"></div>
                <div class="color-btn" style="background:#64748b" onclick="applyColor('#64748b')"></div>
            </div>
        </div>
        <div class="toolbar-divider"></div>
        <button onclick="alignText('justifyLeft')" class="text-white/80"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h14"/></svg></button>
        <button onclick="alignText('justifyCenter')" class="text-white/80"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M7 12h10M5 18h14"/></svg></button>
        <button onclick="alignText('justifyRight')" class="text-white/80"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M10 12h10M6 18h14"/></svg></button>
        <button onclick="alignText('justifyFull')" class="text-white/80"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
        <div class="toolbar-divider"></div>
        <button onclick="clearEditor()" class="hover:!bg-red-500/30 text-red-400"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
    </div>

    <!-- Main Content - A4 Page -->
    <main class="pt-20 pb-12 px-4 main-container">
        <div class="a4-page" id="pageContainer">
            <div id="editor" contenteditable="true" class="editor-area"></div>
            <div class="page-number">Page <span id="currentPage">1</span></div>
            <div class="watermark"><img src="watermark.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        </div>
    </main>

    <!-- Status Bar -->
    <div class="status-bar glass">
        <span id="wordCount">Words: 0 | Characters: 0</span>
        <span id="lastSaved" class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500 pulse"></span> Auto-saved</span>
    </div>

    <!-- Side Menu Panel -->
    <div id="sideMenu" class="fixed top-0 left-0 h-full w-72 bg-gradient-to-b from-slate-900 via-slate-900 to-slate-950 backdrop-blur-xl z-50 transform -translate-x-full transition-transform duration-300 shadow-2xl border-r border-white/5">
        <div class="p-5 h-full overflow-y-auto">
            <div class="flex items-center gap-3 mb-6 pb-4 border-b border-white/10">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </div>
                <div><h1 class="text-lg font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">NabiulWord</h1><p class="text-[10px] text-gray-500">Smart Notepad v1.0</p></div>
            </div>
            <nav class="space-y-1 mb-6">
                <button onclick="newDocument()" class="w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-white/10 transition-all text-left group">
                    <div class="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center group-hover:bg-green-500/30"><svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg></div><span class="text-sm">New Document</span>
                </button>
                <button onclick="document.getElementById('exportBtn').click(); closeSideMenu();" class="w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-white/10 transition-all text-left group">
                    <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center group-hover:bg-blue-500/30"><svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div><span class="text-sm">Export as PDF</span>
                </button>
            </nav>
            <div class="border-t border-white/10 pt-4">
                <div class="mb-4 p-2 rounded-lg hover:bg-white/5 transition-all">
                    <h3 class="text-xs font-semibold text-gray-400 mb-2 flex items-center gap-2"><div class="w-6 h-6 rounded bg-cyan-500/20 flex items-center justify-center"><span class="text-cyan-400 text-[10px] font-bold">Aa</span></div>Font Size<span class="ml-auto text-[10px] bg-white/10 px-2 py-0.5 rounded" id="fontSizeValue">12px</span></h3>
                    <div class="flex items-center gap-2"><span class="text-[10px] text-gray-500">A</span><input type="range" id="fontSizeSlider" min="10" max="24" value="12" class="flex-grow h-1"><span class="text-sm font-bold text-gray-400">A</span></div>
                </div>
                <div class="mb-4 p-2 rounded-lg hover:bg-white/5 transition-all">
                    <h3 class="text-xs font-semibold text-gray-400 mb-2 flex items-center gap-2"><div class="w-6 h-6 rounded bg-yellow-500/20 flex items-center justify-center"><svg class="w-3.5 h-3.5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg></div>Brightness<span class="ml-auto text-[10px] bg-white/10 px-2 py-0.5 rounded" id="brightnessValue">100%</span></h3>
                    <div class="flex items-center gap-2"><svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg><input type="range" id="brightnessSlider" min="50" max="150" value="100" class="flex-grow h-1"><svg class="w-3.5 h-3.5 text-yellow-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 7a5 5 0 100 10 5 5 0 000-10z"/></svg></div>
                </div>
                <div class="mb-4">
                    <h3 class="text-xs font-semibold text-gray-400 mb-2 flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-white/5 transition-all" onclick="toggleThemes()">
                        <div class="w-6 h-6 rounded bg-pink-500/20 flex items-center justify-center"><svg class="w-3.5 h-3.5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg></div>Themes<svg id="themeArrow" class="w-3 h-3 ml-auto transition-transform duration-300 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </h3>
                    <div id="themesContainer" class="hidden grid grid-cols-5 gap-2 mt-2 px-2">
                        <div class="theme-card w-9 h-9 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 shadow-md cursor-pointer hover:scale-110 transition-transform" onclick="setTheme('default')" title="Default"></div>
                        <div class="theme-card w-9 h-9 rounded-lg bg-gradient-to-br from-sky-500 to-cyan-500 shadow-md cursor-pointer hover:scale-110 transition-transform" onclick="setTheme('ocean')" title="Ocean"></div>
                        <div class="theme-card w-9 h-9 rounded-lg bg-gradient-to-br from-green-500 to-emerald-500 shadow-md cursor-pointer hover:scale-110 transition-transform" onclick="setTheme('forest')" title="Forest"></div>
                        <div class="theme-card w-9 h-9 rounded-lg bg-gradient-to-br from-orange-500 to-amber-500 shadow-md cursor-pointer hover:scale-110 transition-transform" onclick="setTheme('sunset')" title="Sunset"></div>
                        <div class="theme-card w-9 h-9 rounded-lg bg-gradient-to-br from-pink-500 to-rose-500 shadow-md cursor-pointer hover:scale-110 transition-transform" onclick="setTheme('rose')" title="Rose"></div>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 mb-3 flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-white/5 transition-all" onclick="toggleAbout()">
                        <div class="w-7 h-7 rounded-lg bg-purple-500/20 flex items-center justify-center"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg></div>About Developer<svg id="aboutArrow" class="w-4 h-4 ml-auto transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </h3>
                    <div id="aboutContainer" class="hidden">
                        <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl p-4 text-center border border-white/5">
                            <div class="relative inline-block mb-3">
                                <img src="profile.jpg" alt="Profile" class="w-20 h-20 rounded-full object-cover border-3 border-indigo-500 shadow-lg shadow-indigo-500/30" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%236366f1%22 width=%22100%22 height=%22100%22 rx=%2250%22/><text x=%2250%22 y=%2260%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2235%22 font-weight=%22bold%22>NH</text></svg>'">
                                <span class="absolute bottom-0 right-0 w-5 h-5 bg-green-500 rounded-full border-2 border-slate-900"></span>
                            </div>
                            <h4 class="font-bold text-base mb-0.5 text-white">Nabiul Hasan</h4>
                            <p class="text-[10px] text-indigo-400 mb-3 font-medium">Developer & Designer</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" class="fixed inset-0 bg-black/60 z-40 hidden"></div>
    <div id="toast" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50 opacity-0 transition-all duration-300 translate-y-10">
        <span id="toastMessage">Saved successfully!</span>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const sideMenu = document.getElementById('sideMenu');
        const overlay = document.getElementById('overlay');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const fontSizeSlider = document.getElementById('fontSizeSlider');
        const brightnessSlider = document.getElementById('brightnessSlider');
        const exportBtn = document.getElementById('exportBtn');
        let saveTimeout;
        let savedSelection = null;

        document.addEventListener('DOMContentLoaded', () => { loadSavedContent(); updateWordCount(); loadSettings(); });
        editor.addEventListener('paste', (e) => {});
        editor.addEventListener('input', () => {
            updateWordCount(); updatePageCount(); clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => { localStorage.setItem('nabiulword_content', editor.innerHTML); showToast('Auto-saved!'); }, 2000);
        });

        function loadSavedContent() { const saved = localStorage.getItem('nabiulword_content'); if (saved) editor.innerHTML = saved; updatePageCount(); }
        function updateWordCount() { const text = editor.innerText || ''; const words = text.trim() ? text.trim().split(/\s+/).length : 0; document.getElementById('wordCount').textContent = `Words: ${words} | Characters: ${text.length}`; }
        function updatePageCount() { const pages = Math.max(1, Math.ceil(editor.scrollHeight / (257 * 3.78))); document.getElementById('currentPage').textContent = pages; }
        function formatText(command) { document.execCommand(command, false, null); editor.focus(); }
        
        function changeSelectedFontSize(delta) {
            const selection = window.getSelection();
            if (!selection.rangeCount || selection.isCollapsed) { showToast('Please select some text first!'); return; }
            const range = selection.getRangeAt(0);
            let currentSize = parseInt(window.getComputedStyle(range.startContainer.parentElement).fontSize) || 12;
            let newSize = Math.max(8, Math.min(72, currentSize + (delta * 4)));
            document.execCommand('fontSize', false, '7');
            editor.querySelectorAll('font[size="7"]').forEach(el => { el.removeAttribute('size'); el.style.fontSize = newSize + 'px'; });
            showToast(`Font size: ${newSize}px`); editor.focus();
        }

        function newDocument() { if (confirm('Create new doc?')) { editor.innerHTML = ''; localStorage.removeItem('nabiulword_content'); showToast('New document created!'); updateWordCount(); closeSideMenu(); } }
        function clearEditor() { if (confirm('Clear all?')) { editor.innerHTML = ''; localStorage.removeItem('nabiulword_content'); showToast('Cleared!'); updateWordCount(); } }

        // --- ULTIMATE FIX PDF EXPORT ---
        exportBtn.addEventListener('click', async () => {
            const content = editor.innerHTML;
            if (!content.trim()) { showToast('Please add content!'); return; }

            const pdfContainer = document.createElement('div');
            pdfContainer.style.cssText = 'width: 200mm; font-family: Times New Roman, serif; color: #1a1a1a; background: white; font-size: 12px; line-height: 1.6; text-align: justify;';
            
            const style = document.createElement('style');
            style.textContent = `
                /* HARDCORE FIX FOR LINE CUTTING */
                p, div, li, h1, h2, h3, h4, h5, h6, tr, td, table {
                    page-break-inside: avoid !important;
                    break-inside: avoid !important;
                    display: block; 
                    margin-bottom: 5px;
                    padding-bottom: 2px; /* Safety buffer for letters like g, y, j */
                }
                span, a, strong, b, i, u { display: inline !important; }
                img { max-width: 100%; height: auto; page-break-inside: avoid; }
            `;
            pdfContainer.appendChild(style);

            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = content;
            pdfContainer.appendChild(contentDiv);

            const opt = {
                // Increased bottom margin to 20mm to act as a safety buffer
                margin: [10, 10, 20, 10], 
                filename: 'NabiulWord_Document.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, letterRendering: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                // Use 'avoid-all' mode which forces element move if it doesn't fit
                pagebreak: { 
                    mode: ['avoid-all', 'css', 'legacy'],
                }
            };

            showToast('Generating PDF...');
            try {
                const pdf = await html2pdf().set(opt).from(pdfContainer).toPdf().get('pdf');
                const totalPages = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    // Borders
                    pdf.setDrawColor(0, 0, 0); pdf.setLineWidth(0.8); pdf.rect(5, 5, 200, 287);
                    pdf.setDrawColor(51, 51, 51); pdf.setLineWidth(0.3); pdf.rect(6.5, 6.5, 197, 284);
                    // Page Number
                    pdf.setFontSize(9); pdf.setTextColor(0);
                    pdf.text(`Page ${i} of ${totalPages}`, 105, 289, { align: 'center' });
                    // Watermark
                    try {
                        const wImg = document.querySelector('.watermark img');
                        if (wImg && wImg.src && !wImg.src.includes('data:')) {
                            pdf.setGState(new pdf.GState({opacity: 0.3}));
                            pdf.addImage(wImg.src, 'PNG', 162, 247, 38, 38, '', 'FAST', 0);
                            pdf.setGState(new pdf.GState({opacity: 1}));
                        }
                    } catch(e) {}
                }
                pdf.save('NabiulWord_Document.pdf');
                showToast('Exported!');
            } catch (e) { showToast('Error!'); console.error(e); }
        });

        hamburgerBtn.addEventListener('click', () => {
            hamburgerBtn.classList.toggle('active');
            if (sideMenu.classList.contains('-translate-x-full')) { sideMenu.classList.remove('-translate-x-full'); overlay.classList.remove('hidden'); }
            else closeSideMenu();
        });
        function closeSideMenu() { sideMenu.classList.add('-translate-x-full'); overlay.classList.add('hidden'); hamburgerBtn.classList.remove('active'); }
        overlay.addEventListener('click', closeSideMenu);
        
        fontSizeSlider.addEventListener('input', (e) => { editor.style.fontSize = e.target.value + 'px'; document.getElementById('fontSizeValue').textContent = e.target.value + 'px'; localStorage.setItem('nabiulword_fontSize', e.target.value); });
        brightnessSlider.addEventListener('input', (e) => { document.documentElement.style.setProperty('--brightness', e.target.value / 100); document.getElementById('brightnessValue').textContent = e.target.value + '%'; localStorage.setItem('nabiulword_brightness', e.target.value); });
        
        function toggleThemes() { document.getElementById('themesContainer').classList.toggle('hidden'); document.getElementById('themeArrow').style.transform = document.getElementById('themesContainer').classList.contains('hidden') ? 'rotate(0)' : 'rotate(180deg)'; }
        function setTheme(theme) { document.body.className = theme === 'default' ? '' : `theme-${theme}`; localStorage.setItem('nabiulword_theme', theme); showToast('Theme applied!'); }
        function toggleAbout() { document.getElementById('aboutContainer').classList.toggle('hidden'); document.getElementById('aboutArrow').style.transform = document.getElementById('aboutContainer').classList.contains('hidden') ? 'rotate(0)' : 'rotate(180deg)'; }
        
        function loadSettings() {
            const fs = localStorage.getItem('nabiulword_fontSize') || 12;
            const br = localStorage.getItem('nabiulword_brightness') || 100;
            const th = localStorage.getItem('nabiulword_theme') || 'default';
            fontSizeSlider.value = fs; editor.style.fontSize = fs + 'px'; document.getElementById('fontSizeValue').textContent = fs + 'px';
            brightnessSlider.value = br; document.documentElement.style.setProperty('--brightness', br / 100); document.getElementById('brightnessValue').textContent = br + '%';
            if (th !== 'default') document.body.className = `theme-${th}`;
        }
        
        function showToast(msg) {
            const t = document.getElementById('toast'); document.getElementById('toastMessage').textContent = msg;
            t.classList.remove('opacity-0', 'translate-y-10'); t.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => { t.classList.add('opacity-0', 'translate-y-10'); t.classList.remove('opacity-100', 'translate-y-0'); }, 3000);
        }
        
        function saveSelection() { const sel = window.getSelection(); if (sel.rangeCount > 0) savedSelection = sel.getRangeAt(0).cloneRange(); }
        function restoreSelection() { if (savedSelection) { const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(savedSelection); } }
        function toggleColorPicker() { saveSelection(); document.getElementById('colorDropdown').classList.toggle('show'); }
        function applyColor(color) {
            restoreSelection();
            setTimeout(() => {
                const sel = window.getSelection();
                if (!savedSelection || sel.isCollapsed) { showToast('Select text first!'); document.getElementById('colorDropdown').classList.remove('show'); return; }
                document.execCommand('styleWithCSS', false, true); document.execCommand('foreColor', false, color);
                document.getElementById('colorDropdown').classList.remove('show'); savedSelection = null; editor.focus();
            }, 10);
        }
        function alignText(a) { editor.focus(); document.execCommand(a, false, null); }
        document.addEventListener('click', (e) => { if (!document.getElementById('colorDropdown').contains(e.target) && !document.getElementById('colorPickerBtn').contains(e.target)) document.getElementById('colorDropdown').classList.remove('show'); });
    </script>
</body>
</html>
